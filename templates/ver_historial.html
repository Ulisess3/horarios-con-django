<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Historial de Tareas</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-4">
    <h3>Historial de Tareas Completadas</h3>

    <form method="get" class="row mb-4 g-2">
        <div class="col-md-3">
            <label class="form-label">Desde</label>
            <input type="date" name="fecha_desde" class="form-control" value="{{ filtros.fecha_desde }}">
        </div>
        <div class="col-md-3">
            <label class="form-label">Hasta</label>
            <input type="date" name="fecha_hasta" class="form-control" value="{{ filtros.fecha_hasta }}">
        </div>
        <div class="col-md-3">
            <label class="form-label">Personal</label>
            <select name="personal" class="form-select">
                <option value="">Todos</option>
                {% for p in personal %}
                    <option value="{{ p.id }}" {% if filtros.personal_id == p.id %}selected{% endif %}>{{ p.nombre }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-3">
            <label class="form-label">Cliente</label>
            <select name="cliente" class="form-select">
                <option value="">Todos</option>
                {% for c in clientes %}
                    <option value="{{ c.id }}" {% if filtros.cliente_id == c.id %}selected{% endif %}>{{ c.nombre }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-12 mt-2">
            <button class="btn btn-primary me-2">Filtrar</button>
            <a href="{% url 'ver_historial' %}" class="btn btn-secondary me-2">Limpiar</a>
            <a href="../dashboard" class="btn btn-outline-danger">Volver</a>
        </div>
    </form>

    <table class="table table-bordered">
        <thead>
        <tr>
            <th>Fecha</th>
            <th>Hora Inicio</th>
            <th>Hora Fin</th>
            <th>Direcci√≥n</th>
            <th>Personal</th>
            <th>Cliente</th>
        </tr>
        </thead>
        <tbody>
        {% for h in historial %}
            <tr>
                <td>{{ h.hora_inicio.date }}</td>
                <td>{{ h.hora_inicio.time }}</td>
                <td>{{ h.hora_fin.time }}</td>
                <td>{{ h.ubicacion }}</td>
                <td>{{ h.asignacion.usuario.nombre }}</td>
                <td>{{ h.asignacion.reserva.usuario.nombre }}</td>
            </tr>
        {% empty %}
            <tr><td colspan="6">No hay registros que coincidan con los filtros.</td></tr>
        {% endfor %}
        </tbody>
    </table>
</div>
</body>
</html>
